<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{url_for('static',filename='cssku/qrcamera.css')}}">
    <title>Scan Table</title>
  </head>
  <body data-instant-allow-query-string data-instant-allow-external-links>
    <main class="default-content" aria-label="Content">
      <div class="wrapper-content">
        <h1 style="text-align: center;"> Please Scan Table First Before order our Food</h1>
        <div class="container">
          <div class="row">
            <div class="col-md-12" style="text-align: center;">
              <div id="qr" style="display: inline-block;">
                <div class="placeholder"> QR Code viewfinder comes here</div>
              </div>
              <div id="scannedCodeContainer"></div>
              <div id="feedback"></div>
            </div>
            
          </div>
        </div>
      </div>
      <div style="display: block; height: 30px"></div>
      
      <script src="{{url_for('static',filename='jsku/jquery.js')}}"></script>
      <script src="{{url_for('static',filename='jsku/qrcode.js')}}"></script>
      <script src="{{url_for('static',filename='jsku/html5qrcode.js')}}"></script>
      <script>
        $(document).ready(function () {
          Html5Qrcode.getCameras().then(cameras => {
            /**
             * devices would be an array of objects of type:
             * { id: "id", label: "label" }
             */
            if (cameras && cameras.length) {
              var cameraId = cameras[0].id;
              // .. use this to start scanning.
          
              const html5QrCode = new Html5Qrcode("qr");
              html5QrCode.start(
                cameraId,     // retreived in the previous step.
                {
                  fps: 10,    // sets the framerate to 10 frame per second
                  qrbox: 250  // sets only 250 X 250 region of viewfinder to
                              // scannable, rest shaded.
                },
                qrCodeMessage => {
                  // do something when code is read. For example:
                  console.log(`QR Code detected: ${qrCodeMessage}`);
                  // window.location.replace(qrCodeMessage)
                  html5QrCode.stop().then(ignore => {
                    // QR Code scanning is stopped.
                    console.log("QR Code scanning stopped.");
                  }).catch(err => {
                    // Stop failed, handle it.
                    console.log("Unable to stop scanning.");
                  });
                },
                errorMessage => {
                  // parse error, ideally ignore it. For example:
                  console.log(`QR Code no longer in front of camera.`);
                })
              .catch(err => {
                // Start failed, handle it. For example,
                console.log(`Unable to start scanning, error: ${err}`);
              });

            }
          }).catch(err => {
            console.log('Error')
          });

        })
      </script>
      
    </div>
  </main>
</body>
</html>